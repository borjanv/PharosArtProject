@*@inherits Umbraco.Web.Mvc.UmbracoViewPage<pharosArt.Models.ProfileMember>
@inherits Umbraco.Web.Mvc.UmbracoTemplatePage<pharosArt.Models.ProfileMember>
@inherits Umbraco.Web.Mvc.UmbracoViewPage<pharosArt.Models.ProfileMember>*@
@*@inherits Umbraco.Web.Mvc.UmbracoTemplatePage*@ 
@using pharosArt.Controllers
@using pharosArt.Models
@model pharosArt.Models.ProfileMember
<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.1.1.min.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.13.1/jquery.validate.min.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/mvc/5.1/jquery.validate.unobtrusive.min.js"></script>
@*@{ 
    var umbracoHelper = new Umbraco.Web.UmbracoHelper(Umbraco.Web.UmbracoContext.Current);
}
@if (umbracoHelper.MemberIsLoggedOn())
{*@
    @using (Html.BeginUmbracoForm("editProfile", "Profile", new { id = Model.memberId, userName = Model.profile.Username }, System.Web.Mvc.FormMethod.Post))
    {
        @Html.AntiForgeryToken()
        int k = 0, i = 0;
        //var myUser = System.Web.Security.Membership.GetUser();
        //if (myUser != null)
        //{
        <div>
            <div>
                <p>Add profile picture2:</p>
                <input type="file" name="FileUpload" id="FileUpload">
                <!--  <input type="button" id="Upload" value="Upload" /> -->
                <p id="responseMessage"></p>
                <!-- on button click clear input,after sending , and if success , display text that it was delivered, if error - same :D-->
            </div>
            <table>
                <tr>
                    <td colspan="4">@Model.memberName; @Model.memberLastName;</td>
                </tr>
                <tr>
                    <td><img src="@Model.profile.urlImage" /></td>
                    <td>@Model.description;</td>
                </tr>
                <tr><td colspan="4"></td></tr>
                @for (i = 0; i < 8; i++)  //list order by date create
                {
                    <tr>
                        @for (k = 0; k < 4; k++)
                        {
                            <td>b</td>
                        }
                        @{k = 0; i = i + 4; }
                    </tr>
                }
            </table>
            @Model.memberName;
            @Model.profile.Username;
        </div>

            @*<p><strong>Logged in as</strong> <span>@myUser.UserName</span></p>*@
            <button name="edit" type="submit"><span>Edit profile</span> <i class="fa fa-arrow-right"></i></button>
            <button id="logout" name="logout" type="submit" onclick="location.href='/SubmitLogout/Login'"><span>logout</span> <i class="fa fa-arrow-right"></i></button>
        //}
    }   
@*}*@

<script>
$("#FileUpload").on("change", function(e) {
   var files = e.target.files;
   var myID = 3;
   if(files.length > 0) {

       if(window.FormData !== undefined) {

           var data = new FormData();
           for (var x = 0; x < files.length; x++) {
               data.append("file" + x, files[x]);
           }
           var imgor = '@Url.Action("UploadImage","Profile")';
           console.log("amazing");
           $.ajax({
               type: "POST",
               url: imgor ,/*?id=' + myID,*/
               contentType: false,
               processData: false,
               data: data,
               success: function(result) {
                   console.log(result);
                   $("#responseMessage").text("Successfully uploaded.")
               },
               error: function( xhr, status, p3, p4) {
                   var err = "Error " + " " + status + " " + p3 + " " + p4;
                   if(xhr.responseText && xhr.responseText[0] == "{")
                       err = JSON.parse(xhr.responseText).Message;
                   $("#responseMessage").text("Error - Couldn't uploaded.")
                    console.log(err);
               }
           });
           console.log("semi amazing");
       } else {

           console.log("This browser doesn't support HTML5 file uploads!");
       }
   }

});

</script>